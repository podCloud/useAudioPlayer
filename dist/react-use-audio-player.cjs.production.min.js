"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r,e,t=require("react"),n=(r=t)&&"object"==typeof r&&"default"in r?r.default:r,o=require("howler");function a(){return(a=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r}).apply(this,arguments)}function u(r,e){if(null==r)return{};var t,n,o={},a=Object.keys(r);for(n=0;n<a.length;n++)e.indexOf(t=a[n])>=0||(o[t]=r[t]);return o}!function(r){r[r.START_LOAD=0]="START_LOAD",r[r.ON_LOAD=1]="ON_LOAD",r[r.ON_PLAY=2]="ON_PLAY",r[r.ON_END=3]="ON_END",r[r.ON_PAUSE=4]="ON_PAUSE",r[r.ON_STOP=5]="ON_STOP",r[r.ON_PLAY_ERROR=6]="ON_PLAY_ERROR",r[r.ON_LOAD_ERROR=7]="ON_LOAD_ERROR"}(e||(e={}));var i={loading:!0,playing:!1,stopped:!0,error:null,duration:0,ready:!1};function l(r,t){switch(t.type){case e.START_LOAD:return a({},r,{loading:!0,stopped:!0,ready:!1,error:null,duration:0});case e.ON_LOAD:return a({},r,{loading:!1,duration:t.duration,ready:!0});case e.ON_PLAY:return a({},r,{playing:!0,stopped:!1});case e.ON_STOP:case e.ON_END:return a({},r,{stopped:!0,playing:!1});case e.ON_PAUSE:return a({},r,{playing:!1});case e.ON_PLAY_ERROR:return a({},r,{playing:!1,stopped:!0,error:t.error});case e.ON_LOAD_ERROR:return a({},r,{playing:!1,stopped:!0,loading:!1,error:t.error});default:return r}}var c=n.createContext(null),s=function(){},p=function(r){var e=t.useContext(c),n=e.player,o=e.load,i=u(e,["player","load"]),l=r||{},p=l.src,d=l.format,f=l.autoplay;t.useEffect((function(){p&&o({src:p,format:d,autoplay:f})}),[p,d,f,o]);var O=t.useCallback((function(){n&&(n.playing()?n.pause():n.play())}),[n]);return a({},i,{play:n?n.play.bind(n):s,pause:n?n.pause.bind(n):s,stop:n?n.stop.bind(n):s,mute:n?n.mute.bind(n):s,seek:n?n.seek.bind(n):s,volume:n?n.volume.bind(n):s,load:o,togglePlayPause:O})};exports.AudioPlayerProvider=function(r){var s=r.children,p=r.value,d=t.useState(null),f=d[0],O=d[1],y=t.useReducer(l,i),_=y[0],A=_.loading,N=_.error,R=_.playing,v=_.stopped,P=_.duration,E=_.ready,g=y[1],L=t.useRef(),m=t.useCallback((function(r){var e=r.src,t=r.format,n=r.autoplay,i=u(r,["src","format","autoplay"]);return new o.Howl(a({src:e,format:t,autoplay:n},i))}),[]),D=t.useCallback((function(r){var t=r.src,n=r.format,o=r.autoplay,i=void 0!==o&&o,l=u(r,["src","format","autoplay"]);g({type:e.START_LOAD});var c=!1;if(L.current){if(L.current._src===t)return;(c=L.current.playing())&&(L.current.stop(),L.current.off(),L.current=void 0)}var s=m(a({src:t,format:n,autoplay:c||i},l));"loaded"===s._state&&g({type:e.ON_LOAD,duration:s.duration()}),s.on("load",(function(){g({type:e.ON_LOAD,duration:s.duration()})})),s.on("play",(function(){g({type:e.ON_PLAY})})),s.on("end",(function(){g({type:e.ON_END})})),s.on("pause",(function(){g({type:e.ON_PAUSE})})),s.on("stop",(function(){g({type:e.ON_STOP})})),s.on("playerror",(function(r,t){g({type:e.ON_PLAY_ERROR,error:new Error("[Play error] "+t)})})),s.on("loaderror",(function(r,t){g({type:e.ON_LOAD_ERROR,error:new Error("[Load error] "+t)})})),O(s),L.current=s}),[m]);t.useEffect((function(){return function(){L.current&&L.current.unload()}}),[]);var b=t.useMemo((function(){return p||{player:f,load:D,error:N,loading:A,playing:R,stopped:v,ready:E,duration:P}}),[A,N,R,v,D,p,f,E,P]);return n.createElement(c.Provider,{value:b},s)},exports.useAudioPlayer=p,exports.useAudioPosition=function(r){void 0===r&&(r={});var e=r.highRefreshRate,n=void 0!==e&&e,o=t.useContext(c),a=o.player,u=o.playing,i=o.stopped,l=o.duration,s=p().seek,d=t.useState(0),f=d[0],O=d[1],y=t.useRef();return t.useEffect((function(){a&&O(a.seek())}),[a,i]),t.useEffect((function(){var r;return!n&&a&&u&&(r=window.setInterval((function(){return O(a.seek())}),1e3)),function(){return clearTimeout(r)}}),[n,a,u]),t.useLayoutEffect((function(){return n&&a&&u&&(y.current=requestAnimationFrame((function r(){O(null==a?void 0:a.seek()),y.current=requestAnimationFrame(r)}))),function(){y.current&&cancelAnimationFrame(y.current)}}),[n,a,u]),{position:f,duration:l,seek:s}};
//# sourceMappingURL=react-use-audio-player.cjs.production.min.js.map
